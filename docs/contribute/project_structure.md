# Project structure

The top-level file structure of the project is documented here:

| Path              | Description                                                                                          |
| ----------------- | ---------------------------------------------------------------------------------------------------- |
| `bin/`            | Output binary files (built firmware), organized by device type                                       |
| `build/`          | Build directory, generated during compilation for all platforms                                      |
| `docs/`           | Markdown project documentation                                                                       |
| `helper_scripts/` | Python scripts for automation (Z2M converters, device docs, etc)                                     |
| `make_scripts/`   | Bash scripts for setup tasks (install dependencies, build all)                                       |
| `silabs_tools/`   | Silicon Labs development tools (SLC CLI, Gecko SDK, Commander)                                       |
| `telink_tools/`   | Telink development tools (TC32 toolchain, flash utilities)                                           |
| `src/`            | Multi-platform source code with Hardware Abstraction Layer                                           |
| `tests/`          | Unit tests using pytest against stub implementation                                                  |
| `zha/`            | ZHA quirks for Home Assistant integration <br> (generated by `make tools/update_zha_quirk`)          |
| `zigbee2mqtt/`    | Z2M converters and OTA indexes <br> (generated by `make tools/update_converters`)                    |
| `device_db.yaml`  | Central device database - single source of truth: [device_db_explained.md](./device_db_explained.md) |
| `board.mk`        | Device-specific build orchestration (queries device_db.yaml)                                         |
| `Makefile`        | Top-level command router for multi-platform builds                                                   |
| `tools.mk`        | Integration tools (Z2M/ZHA generators, documentation updates)                                        |

## Source Code Structure (`src/`)

The source code is organized with a Hardware Abstraction Layer (HAL) to support multiple platforms:

| Path                   | Description                                                 |
| ---------------------- | ----------------------------------------------------------- |
| `src/app.c`            | Main application entry point (minimal, delegates to config) |
| `src/hal/`             | Hardware Abstraction Layer - unified API across platforms   |
| `src/device_config/`   | Device configuration parsing (from device_db.yaml configs)  |
| `src/base_components/` | Shared utility components used across platforms             |
| `src/zigbee/`          | Platform-agnostic Zigbee cluster implementations            |
| `src/telink/`          | Telink TLSR8258 platform-specific code                      |
| `src/silabs/`          | Silicon Labs EFR32MG21 platform-specific code               |
| `src/stub/`            | Host simulation implementation for testing                  |

## Build System Architecture

The build system supports three targets through a layered approach:

1. **Top-level `Makefile`** - Routes commands to platform-specific makefiles
2. **`board.mk`** - Extracts device config from `device_db.yaml` and selects platform
3. **Platform makefiles** - Handle platform-specific build details
   - `src/telink/` - TLSR8258 builds using TC32 toolchain
   - `src/silabs/` - EFR32MG21 builds using SLC CLI and GCC
   - `src/stub/` - Host native builds for testing

## Integration Files

Generated files that integrate with smart home platforms:

- **Zigbee2MQTT**: Converters in `zigbee2mqtt/converters/` and OTA indexes
- **ZHA**: Custom quirks in `zha/switch_quirk.py`
- **Documentation**: Auto-generated device support lists in `docs/devices/`
